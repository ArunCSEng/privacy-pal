<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- ✅ POST SEO -->
  <title>Fix: YubiKey Not Detected on Windows 11 (Kleopatra) — BitDark Blog</title>
  <meta name="description" content="Fix YubiKey not detected in Windows 11 + Kleopatra (Gpg4win). Exact symptom-to-fix table, Smart Card service, scdaemon resets, hidden PIN prompts, conflicts, and verification loop." />
  <link rel="canonical" href="https://bitdark.net/blog/yubikey-not-detected-windows-11-kleopatra/" />

  <!-- ✅ REQUIRED FOR AUTO BLOG INDEX -->
  <meta name="bd:category" content="Troubleshooting" />
  <meta name="bd:tags" content="yubikey,windows-11,kleopatra,gpg4win,openpgp,smartcard,scdaemon,pcsc,ccid,usb,no-reader,no-smartcard-reader,card-status,insert-smartcard,pin-prompt,fix,troubleshooting" />
  <meta name="bd:updated" content="2025-12-15" />

  <meta name="robots" content="index,follow" />

  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --line:#e5e7eb;
      --card:#ffffff; --shadow:0 1px 2px rgba(0,0,0,.06);
      --link:#1a73e8; --chip:#f3f4f6;
      --code:#0b1020; --codefg:#e5e7eb;
      --danger:#ef4444;
      --ok:#10b981;
    }
    html[data-theme="dark"]{
      --bg:#0b0f1a; --fg:#e5e7eb; --muted:#9ca3af; --line:#1f2937;
      --card:#0f1626; --shadow:0 1px 2px rgba(0,0,0,.35);
      --link:#8ab4f8; --chip:#111827;
      --code:#050814; --codefg:#e5e7eb;
      --danger:#ff5a5a;
      --ok:#34d399;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font:16px/1.8 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Arial;
    }
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}

    /* Layout */
    .wrap{max-width:1200px;margin:0 auto;padding:18px 16px 70px}

    /* Top bar */
    .topbar{
      position:sticky;top:0;z-index:10;
      background:color-mix(in srgb,var(--bg) 92%,transparent);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{
      max-width:1200px;margin:0 auto;padding:10px 16px;
      display:flex;gap:12px;align-items:center;
    }
    .brand{min-width:180px}
    .brand b{font-size:16px}
    .brand span{font-size:12px;color:var(--muted);display:block}
    .navlinks{display:flex;gap:14px;flex-wrap:wrap}
    .navlinks a{font-size:13px;color:var(--muted)}
    .navlinks a:hover{color:var(--fg); text-decoration:none}
    .searchbar{flex:1;display:flex;justify-content:flex-end}
    .searchWrap{position:relative;width:min(560px,100%)}
    .searchWrap input{
      width:100%;padding:10px 12px 10px 36px;
      border:1px solid var(--line);
      border-radius:14px;background:var(--bg);color:var(--fg);
      outline:none;
    }
    .searchWrap svg{position:absolute;left:12px;top:50%;transform:translateY(-50%);opacity:.5}
    .btn{
      border:1px solid var(--line);background:var(--card);color:var(--fg);
      padding:8px 10px;border-radius:12px;cursor:pointer; box-shadow:var(--shadow);
      font-size:13px;
    }

    /* Breadcrumbs */
    .crumbs{
      margin-top:16px;font-size:13px;color:var(--muted);
      display:flex;gap:8px;flex-wrap:wrap;align-items:center;
    }

    /* Main grid: big content + sidebar */
    .grid{display:grid;gap:16px;margin-top:16px}
    @media(min-width:980px){
      .grid{grid-template-columns:2.3fr 0.9fr}
    }
    .card{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:18px;
      padding:20px;
      box-shadow:var(--shadow);
    }

    /* Typography */
    h1{font-size:32px;line-height:1.2;margin:10px 0 8px}
    h2{font-size:22px;margin:30px 0 10px}
    h3{font-size:18px;margin:20px 0 8px}
    p{margin:12px 0}
    ul,ol{margin:12px 0 12px 18px}
    pre{
      background:var(--code);color:var(--codefg);
      padding:14px;border-radius:14px;overflow:auto;
      border:1px solid rgba(255,255,255,.06);
    }
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .subhead{margin:0 0 10px;font-size:15px;color:var(--muted)}

    .note{
      border-left:4px solid var(--link);
      padding:12px;background:var(--chip);
      border-radius:12px;margin:16px 0;
    }
    .danger{
      border-left:4px solid var(--danger);
      padding:12px;background:color-mix(in srgb, var(--chip) 88%, transparent);
      border-radius:12px;margin:16px 0;
    }
    .ok{
      border-left:4px solid var(--ok);
      padding:12px;background:color-mix(in srgb, var(--chip) 88%, transparent);
      border-radius:12px;margin:16px 0;
    }

    /* Meta row */
    .meta{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      color:var(--muted); font-size:12px; margin:0 0 6px;
    }
    .dot{opacity:.8}

    /* Tags */
    .tagsInline{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{
      border:1px solid var(--line);
      padding:5px 10px;border-radius:999px;
      font-size:12px;color:var(--muted);
      background:color-mix(in srgb, var(--chip) 92%, transparent);
    }

    /* Table */
    table{width:100%;border-collapse:separate;border-spacing:0;margin:14px 0}
    th,td{border:1px solid var(--line);padding:10px;vertical-align:top}
    th{
      background:color-mix(in srgb, var(--chip) 92%, transparent);
      font-size:13px;color:var(--muted);
    }
    td{border-top:none}
    tr td:first-child, tr th:first-child{border-top-left-radius:12px}
    tr td:last-child, tr th:last-child{border-top-right-radius:12px}
    table tr:last-child td:first-child{border-bottom-left-radius:12px}
    table tr:last-child td:last-child{border-bottom-right-radius:12px}

    /* TOC */
    .tocNav{display:flex;flex-direction:column;gap:6px;margin-top:10px}
    .tocNav a{
      font-size:13px;color:var(--muted);
      padding:6px 8px;border-radius:8px;
      text-decoration:none; line-height:1.35;
    }
    .tocNav a:hover{background:var(--chip);color:var(--fg)}
    .toc-h3{padding-left:18px;font-size:12px;opacity:.95}

    /* Ad slot */
    .adSlot{
      margin-top:14px;
      min-height:520px;
      border:1px dashed var(--line);
      border-radius:16px;
      display:flex;align-items:center;justify-content:center;
      color:var(--muted);text-align:center;
      padding:12px;
      background:color-mix(in srgb, var(--bg) 92%, transparent);
    }

    /* Related */
    .relatedGrid{display:grid;gap:12px;margin-top:12px}
    @media(min-width:720px){ .relatedGrid{grid-template-columns:1fr 1fr} }
    .relatedItem{
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      background:color-mix(in srgb, var(--card) 92%, transparent);
    }
    .relatedItem b{display:block;margin-bottom:6px;font-size:14px}
    .relatedItem span{color:var(--muted);font-size:12px}

    footer{
      margin-top:30px;border-top:1px solid var(--line);
      padding-top:12px;font-size:12px;color:var(--muted);
      display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;
    }
    .footRight{margin-left:auto;display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end}
    .footRight a{color:var(--muted)}
    .footRight a:hover{color:var(--fg); text-decoration:none}

    .kbd{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
      border:1px solid var(--line);
      padding:1px 6px;border-radius:8px;
      background:color-mix(in srgb, var(--chip) 86%, transparent);
      font-size:13px;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <b><a href="/" aria-label="BitDark Home">BitDark</a></b>
        <span><a href="/blog/">Blog</a></span>
      </div>

      <div class="searchbar" role="search">
        <form class="searchWrap" action="/blog/" method="GET">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 21l-4.35-4.35m1.85-5.15a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
          </svg>
          <input name="q" id="qTop" placeholder="Search blog…" autocomplete="off">
        </form>
      </div>

      <button class="btn" id="themeBtn" type="button">Theme</button>
    </div>
  </div>

  <div class="wrap">
    <div class="crumbs" aria-label="Breadcrumbs">
      <a href="/">Home</a>
      <span>›</span>
      <a href="/blog/">Blog</a>
      <span>›</span>
      <span id="crumbTitle">Fix: YubiKey Not Detected on Windows 11 (Kleopatra)</span>
    </div>

    <div class="grid">
      <!-- MAIN CONTENT -->
      <article class="card" id="article">
        <h1 id="postTitle">Fix: YubiKey Not Detected on Windows 11 (Kleopatra)</h1>
        <p class="subhead"><b>If Kleopatra can’t see your YubiKey, it’s usually one Windows service, one daemon, or one hidden PIN prompt.</b></p>
        <p class="subhead">This guide is built like a checklist: do the fast tests first, then the deeper fixes. Every step has a “prove it’s fixed” check.</p>

        <!-- ✅ META ROW -->
        <div class="meta" aria-label="Post metadata">
          <span>Updated: <time id="updatedTime" datetime="2025-12-15">Dec 15, 2025</time></span>
          <span class="dot">•</span>
          <span>Category: <b id="postCategory">Troubleshooting</b></span>
          <span class="dot">•</span>
          <span>Read time: <span id="readTime">~10–14 min</span></span>
        </div>

        <div class="tagsInline" aria-label="Tags">
          <span class="tag">YubiKey</span>
          <span class="tag">Windows 11</span>
          <span class="tag">Kleopatra</span>
          <span class="tag">Gpg4win</span>
          <span class="tag">Smart Card</span>
          <span class="tag">OpenPGP</span>
        </div>

        <h2>What “Not Detected” Usually Means</h2>
        <p>Kleopatra is the UI. Detection depends on Windows and GnuPG components working together:</p>
        <ul>
          <li><b>Windows Smart Card service (PC/SC)</b> exposes readers/tokens</li>
          <li><b>GnuPG smartcard daemon (<code>scdaemon</code>)</b> talks to the token</li>
          <li><b>USB stability</b> (ports/hubs/power saving)</li>
        </ul>
        <p>So “not detected” rarely means the key is broken. It usually means one layer stopped talking.</p>

        <h2>Symptoms → Exact Fix Mapping (Start Here)</h2>
        <table aria-label="Symptoms to Fix table">
          <thead>
            <tr>
              <th style="width:32%">Symptom / Error you see</th>
              <th style="width:28%">What it usually means</th>
              <th>Exact fix to try</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><b>“No reader available”</b><br><span class="subhead">or Kleopatra shows no smartcards</span></td>
              <td>PC/SC stack not exposing the token as a reader</td>
              <td>Restart <b>Smart Card</b> service → change USB port → avoid hubs → rerun <code>gpg --card-status</code></td>
            </tr>
            <tr>
              <td><code>gpg --card-status</code> hangs / never returns</td>
              <td>Hidden PIN prompt or stuck daemon</td>
              <td>Check Alt+Tab for PIN dialog → kill daemons (below) → retry</td>
            </tr>
            <tr>
              <td>Works for <b>GitHub/Google login</b> but not in Kleopatra</td>
              <td>FIDO works; OpenPGP smartcard path is failing</td>
              <td>Focus on Smart Card service + scdaemon fixes; browser success doesn’t prove OpenPGP is OK</td>
            </tr>
            <tr>
              <td>Works only after reboot, then breaks again</td>
              <td>Agent/daemon/service getting stuck after sleep/wake or conflicts</td>
              <td>Use the daemon reset commands (below) instead of rebooting every time</td>
            </tr>
            <tr>
              <td>PIN prompt never appears</td>
              <td>Prompt behind window / focus bug</td>
              <td>Minimize all windows → Alt+Tab → Win+D → look for hidden prompt</td>
            </tr>
          </tbody>
        </table>

        <h2>30-Second Quick Test (Fastest Win)</h2>
        <ul>
          <li>Unplug YubiKey → plug directly into the PC (skip hubs for this test)</li>
          <li>Try a different USB port (prefer back ports on desktops)</li>
          <li>Close Kleopatra completely and reopen</li>
          <li>Reboot once (not forever; just to clear a stuck stack)</li>
        </ul>

        <h2>Verification Loop (Prove It’s Fixed)</h2>
        <p>After <b>every change</b>, run this one command:</p>
        <pre>gpg --card-status</pre>

        <div class="ok">
          <b>If you see OpenPGP card details → the hardware path is healthy.</b><br>
          At that point, any remaining issue is usually Kleopatra UI/cache. Restart Kleopatra.
        </div>

        <div class="note">
          <b>Shortcut mindset:</b> Don’t guess. Make one change → run <code>gpg --card-status</code> → continue only if it still fails.
        </div>

        <h2>Step 1: Start / Restart Windows Smart Card Service</h2>
        <p>This is the #1 cause on Windows 11.</p>
        <ol>
          <li>Press <span class="kbd">Win</span> and type <b>Services</b> → open <b>Services</b></li>
          <li>Find <b>Smart Card</b></li>
          <li>Set <b>Startup type</b> to <b>Automatic</b></li>
          <li>Click <b>Start</b> (or <b>Restart</b> if it’s already running)</li>
        </ol>
        <p>Now rerun:</p>
        <pre>gpg --card-status</pre>

        <h2>Step 2: Kill Stuck GnuPG Daemons (Better Than Rebooting)</h2>
        <p>When Windows sleep/wake or app crashes happen, the smartcard daemon can get stuck.</p>
        <pre>gpgconf --kill scdaemon
gpgconf --kill gpg-agent
gpg --card-status</pre>

        <div class="note">
          <b>Why this works:</b> it resets the GnuPG “plumbing” without restarting the whole PC.
        </div>

        <h2>Step 3: The Hidden PIN Prompt (The “It’s Frozen” Illusion)</h2>
        <p>Sometimes the PIN dialog opens behind another window, so you think nothing is happening.</p>
        <ul>
          <li>Press <span class="kbd">Alt</span> + <span class="kbd">Tab</span> and look for a PIN prompt</li>
          <li>Minimize all windows (or press <span class="kbd">Win</span> + <span class="kbd">D</span>)</li>
          <li>Check the taskbar for a small PIN dialog</li>
        </ul>
        <p>Then rerun:</p>
        <pre>gpg --card-status</pre>

        <h2>Step 4: Conflicts (Another App Is Holding the Token)</h2>
        <p>Close these completely for testing (not minimized):</p>
        <ul>
          <li>Yubico Authenticator</li>
          <li>Any other GPG tools</li>
          <li>Browser “security key” popups</li>
          <li>Smartcard/token utilities</li>
        </ul>
        <div class="note">
          <b>Clean test:</b> close everything → run only <code>gpg --card-status</code>.
        </div>

        <h2>Step 5: USB + Power Problems (Yes, It’s Real)</h2>
        <ul>
          <li>Prefer direct connection to the PC</li>
          <li>Avoid USB hubs/extenders while debugging</li>
          <li>Try a different port (rear ports are often more stable)</li>
        </ul>
        <div class="note">
          If your setup “works for weeks then randomly fails,” this is often a hub/power-saving behavior.
        </div>

        <h2>Device Manager Check (When Nothing Makes Sense)</h2>
        <p>Open <b>Device Manager</b> and inspect:</p>
        <ul>
          <li><b>Smart card readers</b></li>
          <li><b>Smart cards</b></li>
          <li><b>Universal Serial Bus devices</b></li>
        </ul>
        <p>If you see a warning icon, unplug the key, uninstall the device entry (device only), then replug.</p>

        <h2>Last Resort (Only After the Verification Loop)</h2>
        <ul>
          <li><b>Reinstall Gpg4win</b> (sometimes a corrupted component breaks scdaemon)</li>
          <li><b>Try a new Windows user profile</b> (rare profile-level permission/agent weirdness)</li>
          <li><b>Test on another PC</b> to isolate key vs PC issue</li>
        </ul>

        <div class="danger">
          <b>Don’t “Reset the YubiKey” casually.</b><br>
          Resetting OpenPGP can permanently delete keys. Do it only if you understand the consequences and have backups.
        </div>

        <h2>Quick Summary (If You Only Want the Fix)</h2>
        <ul>
          <li>1) Restart <b>Smart Card</b> service</li>
          <li>2) Run <code>gpg --card-status</code></li>
          <li>3) If stuck: <code>gpgconf --kill scdaemon</code> + <code>gpgconf --kill gpg-agent</code></li>
          <li>4) Check hidden PIN prompt (Alt+Tab)</li>
          <li>5) Switch USB port (avoid hubs)</li>
        </ul>

        <h2>FAQ</h2>

        <h3>Does this affect passkeys / FIDO login too?</h3>
        <p>This post focuses on <b>OpenPGP smartcard</b> detection for Kleopatra. Your browser passkeys can still work even if OpenPGP is failing.</p>

        <h3>Is CCID driver required on Windows 11?</h3>
        <p>Usually no manual install is needed. Windows handles it. If detection is flaky, it’s more often service/USB/conflicts than “missing driver”.</p>

        <h3>Does YubiKey Manager interfere with Kleopatra?</h3>
        <p>It can during debugging. Close token-related apps fully when running <code>gpg --card-status</code>.</p>

        <h3>Why does reboot “fix” it temporarily?</h3>
        <p>Because reboot resets services and daemons. Use the daemon reset commands so you don’t live in reboot-land.</p>

        <h3>gpg --card-status works, but Kleopatra still shows nothing</h3>
        <p>Restart Kleopatra. If still broken, reboot once and then avoid conflicts (other tools grabbing the token).</p>

        <h2>Related articles</h2>
        <div class="relatedGrid">
          <div class="relatedItem">
            <b><a href="/blog/how-to-hide-sensitive-files-online-in-2026/">How to Hide Sensitive Files Online in 2026</a></b>
            <span>Email + cloud encryption workflow (Gmail/Outlook-safe)</span>
          </div>
          <div class="relatedItem">
            <b><a href="/blog/digitally-sign-pdf-yubikey-okular/">Digitally Sign PDFs with YubiKey + Okular (2026)</a></b>
            <span>Signature workflow that survives forwarding and tampering</span>
          </div>
          <div class="relatedItem">
            <b><a href="/blog/">Browse all posts</a></b>
            <span>Search by keyword/tag</span>
          </div>
          <div class="relatedItem">
            <b><a href="/">Back to BitDark home</a></b>
            <span>Homepage • Matrix experience</span>
          </div>
        </div>
      </article>

      <!-- SIDEBAR -->
      <aside class="card" aria-label="Sidebar">
        <b>On this page</b>
        <nav id="toc" class="tocNav" aria-label="Table of contents"></nav>

        <div class="adSlot">
          Future AdSense / widgets<br>
          (Reserved space)
        </div>
      </aside>
    </div>

    <footer>
      <div>© <span id="year"></span> BitDark.NET</div>
      <div class="footRight">
        <a href="/blog/">Blog</a>
        <a href="/about.html">About</a>
        <a href="/privacy.html">Privacy</a>
        <a href="/terms.html">Terms</a>
        <a href="/faq.html">FAQ</a>
      </div>
    </footer>
  </div>

  <script>
    /* Theme + footer year + breadcrumb + meta sync + keep search term */
    (() => {
      const root = document.documentElement;
      const saved = localStorage.getItem("bd_blog_theme");
      if (saved === "dark" || saved === "light") root.setAttribute("data-theme", saved);

      document.getElementById("themeBtn").addEventListener("click", () => {
        const cur = root.getAttribute("data-theme") || "light";
        const next = cur === "dark" ? "light" : "dark";
        root.setAttribute("data-theme", next);
        localStorage.setItem("bd_blog_theme", next);
      });

      document.getElementById("year").textContent = new Date().getFullYear();

      // Breadcrumb title sync
      const title = (document.getElementById("postTitle")?.textContent || "Post").trim();
      document.getElementById("crumbTitle").textContent = title;

      // Sync category + updated from bd:* meta tags
      const cat = document.querySelector("meta[name='bd:category']")?.content?.trim();
      if (cat) document.getElementById("postCategory").textContent = cat;

      const upd = document.querySelector("meta[name='bd:updated']")?.content?.trim(); // YYYY-MM-DD
      if (upd) {
        const t = document.getElementById("updatedTime");
        t.setAttribute("datetime", upd);
        const dt = new Date(upd + "T00:00:00");
        const pretty = dt.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
        t.textContent = pretty;
      }

      // Keep search term if user came with ?q=
      const params = new URLSearchParams(location.search);
      const q = params.get("q");
      if (q) document.getElementById("qTop").value = q;
    })();

    /* Read time estimate */
    (() => {
      const article = document.getElementById("article");
      const out = document.getElementById("readTime");
      if (!article || !out) return;

      const text = (article.innerText || "").replace(/\s+/g, " ").trim();
      const words = text ? text.split(" ").length : 0;

      const wpmFast = 260;
      const wpmSlow = 220;
      const minFast = Math.max(1, Math.ceil(words / wpmFast));
      const minSlow = Math.max(1, Math.ceil(words / wpmSlow));

      out.textContent = `~${minFast}–${minSlow} min`;
    })();

    /* TOC auto-generate from H2/H3 inside the article */
    (() => {
      const toc = document.getElementById("toc");
      const article = document.getElementById("article");
      if (!toc || !article) return;

      const headings = article.querySelectorAll("h2, h3");
      if (!headings.length) {
        toc.innerHTML = "<span style='color:var(--muted);font-size:13px'>No sections</span>";
        return;
      }

      const slugify = (s) => (s || "")
        .toLowerCase()
        .trim()
        .replace(/[^\p{L}\p{N}\s-]/gu, "")
        .replace(/\s+/g, "-")
        .replace(/-+/g, "-")
        .slice(0, 70);

      const used = new Set();

      headings.forEach((h) => {
        if (!h.id) {
          let id = slugify(h.textContent);
          if (!id) id = "section";
          let n = 2;
          while (used.has(id) || document.getElementById(id)) {
            id = `${slugify(h.textContent)}-${n++}`;
          }
          h.id = id;
          used.add(id);
        }

        const a = document.createElement("a");
        a.href = `#${h.id}`;
        a.textContent = h.textContent.trim();
        if (h.tagName === "H3") a.classList.add("toc-h3");

        a.addEventListener("click", (e) => {
          e.preventDefault();
          document.getElementById(h.id).scrollIntoView({ behavior: "smooth", block: "start" });
          history.replaceState(null, "", `#${h.id}`);
        });

        toc.appendChild(a);
      });
    })();
  </script>
</body>
</html>
